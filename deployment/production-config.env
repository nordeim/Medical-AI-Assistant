# Medical AI Production Deployment Configuration
# Complete production environment configuration with all services
# This file serves as the master configuration for production deployment

# Environment Configuration
ENVIRONMENT=production
CLOUD_PROVIDER=aws
CLUSTER_NAME=medical-ai-prod
NAMESPACE=medical-ai-prod
REGION=us-east-1

# Domain and SSL Configuration
DOMAIN_NAME=medical-ai.example.com
API_DOMAIN=api.medical-ai.example.com
SSL_CERTIFICATE_ARN=arn:aws:acm:us-east-1:ACCOUNT:certificate/CERT-ID
WAF_WEB_ACL_ARN=arn:aws:wafv2:us-east-1:ACCOUNT:regional/webacl/medical-ai-waf

# Database Configuration
DB_ENGINE=postgres
DB_VERSION=15.4
DB_INSTANCE_CLASS=db.r6g.xlarge
DB_ALLOCATED_STORAGE=500
DB_MAX_ALLOCATED_STORAGE=1000
DB_BACKUP_RETENTION_PERIOD=30
DB_MULTI_AZ=true
DB_PUBLICLY_ACCESSIBLE=false

# Redis Configuration
REDIS_NODE_TYPE=cache.r6g.xlarge
REDIS_NUM_CACHE_CLUSTERS=3
REDIS_ENGINE_VERSION=7.0
REDIS_BACKUP_RETENTION_PERIOD=7
REDIS_SNAPSHOT_WINDOW=03:00-05:00

# Application Configuration
FRONTEND_REPLICAS=3
BACKEND_REPLICAS=3
SERVING_REPLICAS=2
FRONTEND_CPU_LIMIT=500m
BACKEND_CPU_LIMIT=2
SERVING_CPU_LIMIT=4

# Auto-scaling Configuration
HPA_MIN_REPLICAS_FRONTEND=3
HPA_MAX_REPLICAS_FRONTEND=10
HPA_CPU_THRESHOLD_FRONTEND=70

HPA_MIN_REPLICAS_BACKEND=3
HPA_MAX_REPLICAS_BACKEND=20
HPA_CPU_THRESHOLD_BACKEND=70

HPA_MIN_REPLICAS_SERVING=2
HPA_MAX_REPLICAS_SERVING=10
HPA_CPU_THRESHOLD_SERVING=70

# GPU Configuration (for model serving)
GPU_INSTANCE_TYPE=p3.2xlarge
GPU_COUNT=1
GPU_MEMORY_FRACTION=0.8

# Security Configuration
ENABLE_RBAC=true
ENABLE_POD_SECURITY_POLICY=true
ENABLE_NETWORK_POLICIES=true
ENABLE_SECRET_ENCRYPTION=true
ENABLE_AUDIT_LOGGING=true
ENABLE_COMPLIANCE_MONITORING=true

# HIPAA Compliance Settings
PHI_ENCRYPTION_AT_REST=true
PHI_ENCRYPTION_IN_TRANSIT=true
AUDIT_LOG_RETENTION_DAYS=2555
BACKUP_ENCRYPTION=true
DATA_CLASSIFICATION=phi
COMPLIANCE_FRAMEWORKS=hipaa,fda,iso27001

# Monitoring Configuration
PROMETHEUS_RETENTION=30d
PROMETHEUS_RETENTION_SIZE=50GB
GRAFANA_RETENTION=90d
ALERTMANAGER_RETENTION=120d
LOG_RETENTION=90d

# Backup Configuration
BACKUP_SCHEDULE_DATABASE=0 2 * * *
BACKUP_SCHEDULE_MODELS=0 4 * * 0
BACKUP_RETENTION_DAYS=2555
BACKUP_ENCRYPTION_KEY=auto-generate
CROSS_REGION_BACKUP=true
DISASTER_RECOVERY_TEST_SCHEDULE=0 6 1 * *

# Performance Tuning
CONNECTION_POOL_SIZE=50
MAX_CONCURRENT_REQUESTS=100
REQUEST_TIMEOUT=60s
INFERENCE_TIMEOUT=300s
MODEL_CACHE_SIZE=100
MAX_BATCH_SIZE=32
MAX_SEQUENCE_LENGTH=512

# Load Balancing
LB_ALGORITHM=least_outstanding_requests
LB_STICKINESS=lb_cookie
LB_STICKINESS_DURATION=86400
LB_HEALTHCHECK_INTERVAL=30s
LB_HEALTHCHECK_TIMEOUT=10s
LB_HEALTHCHECK_HEALTHY_THRESHOLD=2
LB_HEALTHCHECK_UNHEALTHY_THRESHOLD=3

# Resource Limits and Requests
FRONTEND_CPU_REQUEST=100m
FRONTEND_MEMORY_REQUEST=256Mi
FRONTEND_CPU_LIMIT=500m
FRONTEND_MEMORY_LIMIT=1Gi

BACKEND_CPU_REQUEST=200m
BACKEND_MEMORY_REQUEST=1Gi
BACKEND_CPU_LIMIT=2
BACKEND_MEMORY_LIMIT=4Gi

SERVING_CPU_REQUEST=1000m
SERVING_MEMORY_REQUEST=4Gi
SERVING_CPU_LIMIT=4
SERVING_MEMORY_LIMIT=16Gi

# Storage Configuration
STORAGE_CLASS_FAST_SSD=fast-ssd
STORAGE_CLASS_GP3=gp3
PERSISTENT_VOLUME_SIZE_MODELS=100Gi
PERSISTENT_VOLUME_SIZE_DATA=500Gi
PERSISTENT_VOLUME_SIZE_BACKUP=100Gi

# Network Configuration
NETWORK_POLICY_DEFAULT_DENY=true
NETWORK_POLICY_ALLOW_APP_TRAFFIC=true
NETWORK_POLICY_ALLOW_MONITORING=true
SERVICE_MESH_ENABLED=false
INGRESS_CLASS=alb

# Compliance and Audit Settings
COMPLIANCE_CHECK_INTERVAL=1h
SECURITY_SCAN_INTERVAL=24h
VULNERABILITY_SCAN_INTERVAL=7d
PENETRATION_TEST_INTERVAL=90d
COMPLIANCE_REPORT_INTERVAL=30d

# Alert Thresholds
CPU_UTILIZATION_THRESHOLD=90%
MEMORY_UTILIZATION_THRESHOLD=90%
DISK_USAGE_THRESHOLD=90%
ERROR_RATE_THRESHOLD=1%
LATENCY_P95_THRESHOLD=1s
AVAILABILITY_SLO=99.9%

# Notification Settings
ALERT_EMAIL_SECURITY=security@medical-ai.example.com
ALERT_EMAIL_COMPLIANCE=compliance@medical-ai.example.com
ALERT_EMAIL_FDA=fda@medical-ai.example.com
ALERT_EMAIL_DEVOPS=devops@medical-ai.example.com
ALERT_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# Health Check Configuration
HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3
HEALTH_CHECK_START_PERIOD=60s

# SSL/TLS Configuration
TLS_MIN_VERSION=1.2
TLS_CIPHERS='ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256'
SSL_REDIRECT=true
HSTS_MAX_AGE=31536000

# Session Management
SESSION_TIMEOUT=28800
SESSION_SECURE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# Caching Configuration
REDIS_MAXMEMORY_POLICY=allkeys-lru
CACHE_TTL_DEFAULT=3600
CACHE_TTL_STATIC=86400
CACHE_TTL_DYNAMIC=1800

# Container Security
CONTAINER_SECURITY_CONTEXT_RUN_AS_NON_ROOT=true
CONTAINER_SECURITY_CONTEXT_READ_ONLY_ROOT_FILESYSTEM=true
CONTAINER_SECURITY_CONTEXT_DROP_CAPABILITIES=ALL
CONTAINER_SECURITY_CONTEXT_ALLOW_PRIVILEGE_ESCALATION=false

# Kubernetes Security
POD_SECURITY_CONTEXT_RUN_AS_NON_ROOT=true
POD_SECURITY_CONTEXT_FS_GROUP=1001
POD_SECURITY_CONTEXT_SECCOMP_PROFILE=RuntimeDefault

# Service Account Configuration
SERVICE_ACCOUNT_BACKEND=medical-ai-backend-sa
SERVICE_ACCOUNT_FRONTEND=medical-ai-frontend-sa
SERVICE_ACCOUNT_SERVING=medical-ai-serving-sa
SERVICE_ACCOUNT_MONITORING=medical-ai-monitoring-sa
SERVICE_ACCOUNT_BACKUP=medical-ai-backup-sa

# Priority Classes
PRIORITY_CLASS_CRITICAL=medical-ai-critical
PRIORITY_CLASS_HIGH=medical-ai-high
PRIORITY_CLASS_NORMAL=medical-ai-normal
PRIORITY_CLASS_BACKGROUND=medical-ai-background

# Node Labels
NODE_LABEL_WORKLOAD_GENERAL=workload-type=general
NODE_LABEL_WORKLOAD_BACKEND=workload-type=backend
NODE_LABEL_WORKLOAD_FRONTEND=workload-type=frontend
NODE_LABEL_WORKLOAD_GPU=workload-type=gpu
NODE_LABEL_COMPLIANCE=compliance=hipaa
NODE_LABEL_DATA_CLASSIFICATION=data-classification=phi

# Taints and Tolerations
TAINT_BACKEND=medical-ai-dedicated=backend:NoSchedule
TAINT_FRONTEND=medical-ai-dedicated=frontend:NoSchedule
TAINT_GPU=nvidia.com/gpu=true:NoSchedule

# Deployment Strategy
DEPLOYMENT_STRATEGY=RollingUpdate
DEPLOYMENT_MAX_UNAVAILABLE=1
DEPLOYMENT_MAX_SURGE=1
DEPLOYMENT_PROGRESS_DEADLINE=300s

# Pod Disruption Budgets
PDB_MIN_AVAILABLE_FRONTEND=2
PDB_MIN_AVAILABLE_BACKEND=2
PDB_MIN_AVAILABLE_SERVING=1

# Resource Quotas
QUOTA_CPU_REQUESTS=20
QUOTA_CPU_LIMITS=40
QUOTA_MEMORY_REQUESTS=64Gi
QUOTA_MEMORY_LIMITS=128Gi
QUOTA_PODS=50
QUOTA_SERVICES=10
QUOTA_SECRETS=50
QUOTA_STORAGE=500Gi

# Vertical Pod Autoscaler
VPA_UPDATE_MODE=Auto
VPA_MIN_CPU_REQUEST=100m
VPA_MIN_MEMORY_REQUEST=256Mi
VPA_MAX_CPU=4
VPA_MAX_MEMORY=8Gi

# Cluster Autoscaler
CLUSTER_AUTOSCALER_ENABLED=true
CLUSTER_AUTOSCALER_SCALE_DOWN_ENABLED=true
CLUSTER_AUTOSCALER_SCALE_DOWN_DELAY=10m
CLUSTER_AUTOSCALER_SCALE_DOWN_UTILIZATION_THRESHOLD=0.5
CLUSTER_AUTOSCALER_MAX_NODE_PROVISION_TIME=15m

# Istio Configuration (if service mesh is enabled)
ISTIO_ENABLED=false
ISTIO_INJECTION_ENABLED=true
ISTIO_MUTUAL_TLS=true
ISTIO_TRACING_ENABLED=true
ISTIO_RETENTION_TIME=24h

# Distributed Tracing
JAEGER_ENABLED=true
JAEGER_RETENTION_TIME=7d
JAEGER_SAMPLING_RATE=0.1
JAEGER_STORAGE_TYPE=elasticsearch

# Logging Configuration
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_INCLUDE_STACK_TRACE=true
LOG_SENSITIVE_DATA=false
LOG_AUDIT_EVENTS=true

# Application Performance Monitoring
APM_ENABLED=true
APM_SAMPLING_RATE=1.0
APM_SERVICE_NAME=medical-ai
APM_ENVIRONMENT=production
APM_TRACES_ENABLED=true
APM_METRICS_ENABLED=true

# Feature Flags
FEATURE_CLINICAL_DECISION_SUPPORT=true
FEATURE_ADVANCED_ANALYTICS=false
FEATURE_ML_MODEL_RETRAINING=true
FEATURE_A_B_TESTING=false
FEATURE_CANARY_DEPLOYMENTS=true
FEATURE_BLUE_GREEN_DEPLOYMENTS=true

# API Configuration
API_VERSION=v1
API_RATE_LIMIT=100
API_RATE_LIMIT_AUTH=10
API_TIMEOUT=30s
API_MAX_REQUEST_SIZE=20MB
API_CORS_ORIGINS=https://medical-ai.example.com,https://admin.medical-ai.example.com

# Database Connection Pool
DB_POOL_SIZE=10
DB_POOL_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30s
DB_POOL_RECYCLE=3600s
DB_POOL_PRE_PING=true

# Redis Connection Pool
REDIS_POOL_SIZE=10
REDIS_POOL_MAX_OVERFLOW=20
REDIS_POOL_TIMEOUT=5s
REDIS_POOL_SOCKET_TIMEOUT=5s

# Web Application Firewall
WAF_ENABLED=true
WAF_RULE_VERSION=CRSv3
WAF_EXCLUDED_RULES=REQUEST-942-APPLICATION-ATTACK-SQLI
WAF_RATE_LIMITING_ENABLED=true
WAF_RATE_LIMIT_BURST=2000
WAF_RATE_LIMIT_SUSTAINED=1000

# DDoS Protection
DDoS_PROTECTION_ENABLED=true
DDoS_PROTECTION_PROVIDER=aws-shield
DDoS_PROTECTION_ADVANCED=true

# Content Delivery Network
CDN_ENABLED=true
CDN_PROVIDER=cloudfront
CDN_CACHE_TTL_STATIC=31536000
CDN_CACHE_TTL_DYNAMIC=3600
CDN_COMPRESSION_ENABLED=true

# Data Loss Prevention
DLP_ENABLED=true
DLP_SCAN_SENSITIVE_DATA=true
DLP_MASK_PHONE_NUMBERS=true
DLP_MASK_EMAIL_ADDRESSES=true
DLP_MASK_CREDIT_CARDS=true

# Certificate Management
CERT_MANAGER_ENABLED=true
CERT_CLUSTER_ISSUER=letsencrypt-prod
CERT_DNS01_ENABLED=true
CERT_HTTP01_ENABLED=false
CERT_RENEW_BEFORE=30d

# Secrets Management
SECRETS_PROVIDER=external-secrets
SECRETS_SYNC_ENABLED=true
SECRETS_AUTO_ROTATION=true
SECRETS_ENCRYPTION_PROVIDER=aesgcm

# Backup Verification
BACKUP_VERIFICATION_ENABLED=true
BACKUP_VERIFICATION_SCHEDULE=0 8 * * *
BACKUP_TEST_RESTORE_ENABLED=true
BACKUP_TEST_RESTORE_SCHEDULE=0 6 1 * *

# Incident Response
INCIDENT_RESPONSE_ENABLED=true
INCIDENT_RESPONSE_WEBHOOK=https://hooks.slack.com/services/YOUR/INCIDENT/WEBHOOK
INCIDENT_RESPONSE_CHANNEL=#incidents
INCIDENT_RESPONSE_ESCALATION_TIMEOUT=15m

# Change Management
CHANGE_MANAGEMENT_ENABLED=true
CHANGE_APPROVAL_REQUIRED=true
CHANGE_AUTOMATED_TESTING=true
CHANGE_ROLLBACK_ENABLED=true
CHANGE_COMMUNICATION_REQUIRED=true

# Documentation
DOCS_VERSION=v1.0.0
DOCS_API_ENABLED=true
DOCS_DEPLOYMENT_ENABLED=true
DOCS_OPERATIONAL_ENABLED=true
DOCS_COMPLIANCE_ENABLED=true